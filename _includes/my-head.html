<!-- Add HTML tags here to be included in the head. You can delete the below: -->
<link rel="dns-prefetch" href="https://assets.gumroad.com">

<style>
    .inline-math {
        display: inline !important;
        margin: 0 !important;
    }

    .inline-math .katex-display {
        display: inline !important;
        margin: 0 !important;
        text-align: left !important;
    }

    .result-equation {
        display: block !important;
        margin: 0.5em 0 !important;
        text-align: center !important;
        background: none !important;
        border: none !important;
        padding: 0 !important;
    }

    .result-equation .katex-display {
        margin: 0 !important;
        padding: 0 !important;
        background: none !important;
    }

    .equation-left {
        display: block;
        text-align: left;
        margin: 0.5em 0;
    }

    .equation-left .katex-display {
        text-align: left !important;
        margin: 0 !important;
        padding: 0 !important;
    }

    .left-aligned-list {
        text-align: left;
    }

    .left-aligned-list li {
        text-align: left;
        margin-bottom: 0.5em;
    }


    .left-align-math .katex-display {
        text-align: left !important;
        margin-left: 0 !important;
        padding-left: 0 !important;
    }

</style>
<script type="module">
  const loadJS = x => new Promise(r => window.loadJS(x).addEventListener('load', r));

  let p1, p2, io1, io2, embedCreated, overlayCreated;
  document.querySelector('hy-push-state').addEventListener('load', () => {
    io1 ||= new IntersectionObserver(async (entries) => {
      if (entries.some(x => x.isIntersecting)) {
        p1 = p1 || loadJS('https://gumroad.com/js/gumroad-embed.js');
        await p1;
        !embedCreated && await new Promise(function check1(res) {
          if (typeof createGumroadEmbed !== 'undefined')  {
            embedCreated = 1;
            res(createGumroadEmbed());
          }
          else setTimeout(() => check1(res), 200);
        });
        await new Promise(function check2(res) {
          if (typeof GumroadEmbed !== 'undefined') res(GumroadEmbed.reload());
          else setTimeout(() => check2(res), 200);
        });
      }
    }, { rootMargin: '1440px' });

    io2 ||= new IntersectionObserver(async (entries) => {
      if (entries.some(x => x.isIntersecting)) {
        p2 = p2 || loadJS('https://gumroad.com/js/gumroad.js');
        await p2;
        !overlayCreated && await new Promise(function check(res) {
          if (typeof createGumroadOverlay !== 'undefined') {
            overlayCreated = 1;
            res(createGumroadOverlay());
          }
          else setTimeout(() => check(res), 200);
        });
      }
    }, { rootMargin: '300px' });

    document.querySelectorAll('.gumroad-product-embed').forEach(el => io1.observe(el));
    document.querySelectorAll('.gumroad-button').forEach(el => io2.observe(el));
  });
</script>

<!-- KaTeX CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">

<!-- KaTeX JavaScript -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>

<!-- KaTeX Auto-render configuration with debug -->
<script>
    function renderMath() {
        console.log('renderMath called');
        if (typeof renderMathInElement !== 'undefined') {
            console.log('KaTeX auto-render is available');
            try {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: "$$", right: "$$", display: true},
                        {left: "$", right: "$", display: false},
                        {left: "\\(", right: "\\)", display: false},
                        {left: "\\[", right: "\\]", display: true}
                    ],
                    throwOnError: false,
                    ignoredTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                    errorCallback: function(msg, err) {
                        console.error('KaTeX error:', msg, err);
                    }
                });
                console.log('KaTeX rendering completed');
            } catch (error) {
                console.error('Error during KaTeX rendering:', error);
            }
        } else {
            console.error('renderMathInElement is not defined - KaTeX auto-render not loaded');
        }
    }

    // Test if KaTeX core is loaded
    document.addEventListener("DOMContentLoaded", function() {
        console.log('DOM loaded');
        if (typeof katex !== 'undefined') {
            console.log('KaTeX core is loaded');
        } else {
            console.error('KaTeX core is NOT loaded');
        }

        // Delay rendering to ensure scripts are loaded
        setTimeout(renderMath, 500);
    });

    // Also try on window load
    window.addEventListener('load', function() {
        console.log('Window loaded');
        setTimeout(renderMath, 100);
    });

    // For Hydejack SPA navigation
    if (document.querySelector('hy-push-state')) {
        document.querySelector('hy-push-state').addEventListener('load', function() {
            console.log('Hydejack page loaded');
            setTimeout(renderMath, 100);
        });
    }
</script>

{% comment %}
<!--
Example code for using Matamo as alternative analytics solution.
-->
{% if site.matomo_analytics %}
<script>
    var _paq = _paq || [];

    /*{% if site.matomo_analytics.no_cookies %}*/
    _paq.push(['disableCookies']);
    /*{% endif %}*/

    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '{{site.matomo_analytics.site_id}}']);

    var pushStateEl = document.getElementById('_pushState');
    var timeStartLoadPage, referer, timeItTookToLoadPage;

    pushStateEl.addEventListener('hy-push-state-start', function() {
        timeStartLoadPage = new Date().getTime();
        referer = window.location.toString();
    });

    pushStateEl.addEventListener('hy-push-state-ready', function() {
        timeItTookToLoadPage = new Date().getTime() - timeStartLoadPage;
    });

    pushStateEl.addEventListener('hy-push-state-after', function() {
        _paq.push(['setReferrerUrl', referer]);
        _paq.push(['setCustomUrl', window.location.toString()]);
        _paq.push(['setDocumentTitle', document.title]);
        _paq.push(['deleteCustomVariables', 'page']);
        _paq.push(['setGenerationTimeMs', timeItTookToLoadPage]);
        _paq.push(['trackPageView']);
    });

    window.loadJSDeferred('{{site.matomo_analytics.root}}piwik.js');
</script>
{% endif %}
{% endcomment %}